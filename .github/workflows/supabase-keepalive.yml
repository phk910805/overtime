name: Supabase Keep-Alive

on:
  schedule:
    # ì£¼ 3íšŒ ì‹¤í–‰ (ì›”/ìˆ˜/ê¸ˆ ì˜¤ì „ 9ì‹œ KST = UTC 0ì‹œ)
    - cron: '0 0 * * 1,3,5'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Keep Supabase Active with DB Query
        run: |
          echo "ğŸ“ Keeping Supabase active with real DB query..."
          echo "Timestamp: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          
          # ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ì‹¤í–‰
          response=$(curl -s -o /dev/null -w "%{http_code}" \
            -X GET '${{ secrets.SUPABASE_URL }}/rest/v1/overtime_records?limit=1' \
            -H "apikey: ${{ secrets.SUPABASE_ANON_KEY }}" \
            -H "Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}")
          
          echo "HTTP Response: $response"
          
          if [ $response -eq 200 ]; then
            echo "âœ… Success! Database query executed successfully."
          elif [ $response -eq 401 ]; then
            echo "âœ… Supabase is alive (auth required but reachable)."
          else
            echo "âš ï¸ Unexpected response: HTTP $response"
            exit 1
          fi
          
          echo "ğŸ‰ Keep-alive ping completed!"
